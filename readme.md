---
title: "Орион про - ограничение количества въездов в паркинг"
date: 24.06.2019
autor: ВВВ
output:
  html_document:
    theme: lumen
---

**Задача**

Нужно ограничить количество автомашин, которые могут въехать на паркинг для арендатора в зависимости от количества выкупленных
парковочных мест.

Варианты решения
----------------

Болид предлагает несколько модулей, для работы со своей системой.

[Модуль интеграции Орион Про по XML-RPC](https://shop.bolid.ru/catalog/803660864/847479212/tovar_758799466.html)
для интеграции со сторонними системами - цена 21 840руб. к серверу не привязан.
Обеспечивает доступ стороннего ПО к базе данных Болид, есть ли возможность вклиниться в процесс реагирования не очень понятно. По первому впечатлению, возможности организовать шлюз для пропуска
информации и принятия решения по конкретному контроллеру нельзя.

[Модуль управления ИСО Орион](https://shop.bolid.ru/catalog/803660864/847479212/tovar_125311674.html) альтернативный вариант ядра,
вместо интерфейса позволят стороннему ПО управлять работой аппаратурой Болид - нужнен полнофункиональная система со своей базой данных, которая будет работать вместо ядра Болид!!
База данных Болид в этом случае не используется. 

Вариант на базе скриптов
------------------------

Скриптовой язык Орион Про в зачаточном состоянии, нет отладчика, отчасти напоминает 1С.

Для принятия решения нужно получить ID пользователя и ID компании пользователя.
В нормальном состоянии для всех пользователей нужно закрыть доступ на вход и разрешать его
на основании текущих данных о занятых парковочных местах.

Количество мест для компании ограничиваем в файле c:/scripts/Арендаторы.txt

    # так начинаем коментарий
    # формат - имя компании : ID компании : количество парковочных мест
    Компания 1 : 1 : 2
    Компания 2 : 2 : 3

Текущее состояние храним в файле c:/scripts/Места.txt

    # так начинаем коментарий
    # ID компании : количество заехавщих машин
    1 : 0
    2 : 1

Логика работы на въезд
----------------------

1. читаем данные из файла Арендаторы.txt

2. получаем объект сотрудник для предъявленного ключа

3. проверить входит ли этот сотрудник в компанию из списка с ограничениями

4. если входит, то читаем файл Места.txt и выясняем есть ли свободное место для данной компании

    1. Место есть - тогда добавляем 1 к данным в списке Места.txt и даем доступ, можно вызвать внешний скрипт, чтобы не мучиться.

    2. Мест нет - запрещаем доступ и пишем сообщение оператору, можно со звуком.

Логика работы на въезд
----------------------

1. читаем данные из файла Арендаторы.txt

2. получаем объект сотрудник для предъявленного ключа

3. проверить входит ли этот сотрудник в компанию из списка с ограничениями

4. если входит, то читаем файл Места.txt, уменьшаем данные по этой компании на 1 и выпусаем машину, можно просто вызвать скрипт для
   изменения файлов.

Сброс состояния счетчиков
-------------------------

Нужный отдельный скрипт, который будет удалять или обнулять состояние счетчиков в файле Места, для восстановления работы программы
в случае сбоя.

Вопросы
-------

Порядок работы при ручном пропуске машины из списка непонятен.

Разработка
----------

1. Чтение и разбор файла

2. Сообщение на экран и звуком для оператора

3. Править файлы можно во внешнем скрипте - для упрощения работы. В этом случае можно унифицировать работу с файлами.
   Вопрос, будет ли Орион ждать окончания работы внешнего скрипта.

4. Отладочные сообщения о работе в экран оператору


Для объекта **ядро** можно вызвать

- ЗапуститьПрограмму( "ПолноеИмяФайла" , "Параметр" ) - запустить внешнюю программу с параметром.

- ЗаписьВФайл( "ПолноеИмяФайла" , Смещение , "ЗаписываемаяСтрока" ) - запись строки в текстовый файл, начиная с позиции, смещенной на
указанное число байт от начала файла.

- ЧтениеИзФайла( "ПолноеИмяФайла", Смещение, Длина ) : Строка - чтение строки указанной длины из текстового файла, начиная с позиции,
смещенной на указанное число байт от начала файла.

- РазмерФайла("ПолноеИмяФайла" ) : Число - возвращает размер файла. Возможно, дополнительные.

Реакция на выход можно сделать в отдельном скрипте который будет корежить файл Места.тхт - есть опасность конфликта на запись в этот файл.

Для объекта **РабочееМесто (Оболочка)** можно вызвать

- ЗапуститьПрограмму( "ПолноеИмяФайла" , "Параметр" ) - запустить внешнюю программу с параметром.

- ЗаписатьВЖурналСобытий( "Текст" ) – занесение данных в журнал событий.


